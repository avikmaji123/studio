{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account on the platform, whether student, affiliate, or admin.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "profilePicture": {
          "type": "string",
          "description": "URL to the user's profile picture.",
          "format": "uri"
        },
        "themePreference": {
          "type": "string",
          "description": "User's preferred theme (e.g., light, dark)."
        },
        "walletBalance": {
          "type": "number",
          "description": "User's points balance in their wallet."
        },
        "affiliateCode": {
          "type": "string",
          "description": "Unique affiliate code assigned to the user."
        },
        "role": {
          "type": "string",
          "description": "User's role (e.g., student, affiliate, admin)."
        },
        "suspended": {
          "type": "boolean",
          "description": "Indicates whether the user account is suspended."
        },
        "adminNotes": {
          "type": "string",
          "description": "Notes added by admin regarding the user account."
        },
        "trustScore": {
          "type": "number",
          "description": "User's trust score as determined by AutoHandle engine."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "themePreference",
        "walletBalance",
        "affiliateCode",
        "role",
        "suspended"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a course offered on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the course."
        },
        "title": {
          "type": "string",
          "description": "Title of the course."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the course."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL to the course image.",
          "format": "uri"
        },
        "status": {
          "type": "string",
          "description": "Course status (e.g., draft, published)."
        },
        "lessons": {
          "type": "array",
          "description": "An array of lessons associated with the course.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "imageUrl",
        "status",
        "lessons"
      ]
    },
    "Lesson": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lesson",
      "type": "object",
      "description": "Represents a single lesson within a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the lesson."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Lesson)"
        },
        "title": {
          "type": "string",
          "description": "Title of the lesson."
        },
        "content": {
          "type": "string",
          "description": "Content of the lesson (e.g., text, video URL)."
        },
        "order": {
          "type": "number",
          "description": "Order of the lesson within the course."
        }
      },
      "required": [
        "id",
        "courseId",
        "title",
        "content",
        "order"
      ]
    },
    "Enrollment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Enrollment",
      "type": "object",
      "description": "Represents a user's enrollment in a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the enrollment."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Enrollment)"
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Enrollment)"
        },
        "enrollmentDate": {
          "type": "string",
          "description": "Date when the user enrolled in the course.",
          "format": "date-time"
        },
        "completionPercentage": {
          "type": "number",
          "description": "The user's completion percentage."
        }
      },
      "required": [
        "id",
        "userId",
        "courseId",
        "enrollmentDate",
        "completionPercentage"
      ]
    },
    "Certificate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Certificate",
      "type": "object",
      "description": "Represents a certificate issued to a user upon completion of a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the certificate."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Certificate)"
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Certificate)"
        },
        "issueDate": {
          "type": "string",
          "description": "Date when the certificate was issued.",
          "format": "date-time"
        },
        "certificateUrl": {
          "type": "string",
          "description": "URL to the certificate file.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "userId",
        "courseId",
        "issueDate",
        "certificateUrl"
      ]
    },
    "PaymentTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PaymentTransaction",
      "type": "object",
      "description": "Represents a payment transaction made by a user to purchase points.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N PaymentTransaction)"
        },
        "amount": {
          "type": "number",
          "description": "Amount paid by the user in INR."
        },
        "pointsAwarded": {
          "type": "number",
          "description": "Number of points awarded to the user for the transaction."
        },
        "upiTransactionReference": {
          "type": "string",
          "description": "UPI transaction reference number provided by the user."
        },
        "screenshotUrl": {
          "type": "string",
          "description": "URL to the screenshot of the payment (optional).",
          "format": "uri"
        },
        "status": {
          "type": "string",
          "description": "Status of the transaction (e.g., pending, approved, rejected)."
        },
        "transactionDate": {
          "type": "string",
          "description": "Date and time of the transaction.",
          "format": "date-time"
        },
        "adminNotes": {
          "type": "string",
          "description": "Notes added by admin regarding the transaction."
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "pointsAwarded",
        "upiTransactionReference",
        "status",
        "transactionDate"
      ]
    },
    "AffiliateCommission": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AffiliateCommission",
      "type": "object",
      "description": "Represents a commission earned by an affiliate for a referral.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the commission."
        },
        "affiliateId": {
          "type": "string",
          "description": "Reference to User (affiliate). (Relationship: User 1:N AffiliateCommission)"
        },
        "referredUserId": {
          "type": "string",
          "description": "Reference to User (referred user). (Relationship: User 1:N AffiliateCommission)"
        },
        "commissionPercentage": {
          "type": "number",
          "description": "Percentage of the purchase amount earned as commission."
        },
        "pointsAwarded": {
          "type": "number",
          "description": "Number of points awarded to the affiliate as commission."
        },
        "transactionDate": {
          "type": "string",
          "description": "Date and time when the commission was earned.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "affiliateId",
        "referredUserId",
        "commissionPercentage",
        "pointsAwarded",
        "transactionDate"
      ]
    },
    "ApiLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApiLog",
      "type": "object",
      "description": "Represents a log entry for an API request.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the log entry."
        },
        "apiKeyId": {
          "type": "string",
          "description": "Reference to ApiKey (Relationship: ApiKey 1:N ApiLog)"
        },
        "requestUrl": {
          "type": "string",
          "description": "The URL of the API request."
        },
        "requestMethod": {
          "type": "string",
          "description": "The HTTP method used for the request (e.g., GET, POST)."
        },
        "requestTimestamp": {
          "type": "string",
          "description": "Timestamp of the API request.",
          "format": "date-time"
        },
        "responseStatusCode": {
          "type": "number",
          "description": "The HTTP status code of the API response."
        },
        "affiliateCode": {
          "type": "string",
          "description": "Affiliate code included in the API request (if any)."
        }
      },
      "required": [
        "id",
        "apiKeyId",
        "requestUrl",
        "requestMethod",
        "requestTimestamp",
        "responseStatusCode"
      ]
    },
    "ApiKey": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApiKey",
      "type": "object",
      "description": "Represents an API key that can be used to access the API.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the API key."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User (admin who created the key). (Relationship: User 1:N ApiKey)"
        },
        "key": {
          "type": "string",
          "description": "The API key itself."
        },
        "description": {
          "type": "string",
          "description": "Description of the API key's purpose."
        },
        "rateLimit": {
          "type": "number",
          "description": "The rate limit for the API key (requests per minute/hour)."
        },
        "readOnly": {
          "type": "boolean",
          "description": "Indicates whether the API key has read-only access."
        },
        "createdDate": {
          "type": "string",
          "description": "Date and time when the API key was created.",
          "format": "date-time"
        },
        "revoked": {
          "type": "boolean",
          "description": "Indicates whether the API key has been revoked."
        }
      },
      "required": [
        "id",
        "userId",
        "key",
        "description",
        "rateLimit",
        "readOnly",
        "createdDate",
        "revoked"
      ]
    },
    "AdminActionLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdminActionLog",
      "type": "object",
      "description": "Represents a log entry for an action performed by an administrator.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the log entry."
        },
        "adminId": {
          "type": "string",
          "description": "Reference to User (admin performing the action). (Relationship: User 1:N AdminActionLog)"
        },
        "action": {
          "type": "string",
          "description": "Description of the action performed (e.g., 'Approved payment', 'Suspended user')."
        },
        "affectedEntity": {
          "type": "string",
          "description": "The entity affected by the action (e.g., 'User', 'PaymentTransaction')."
        },
        "affectedEntityId": {
          "type": "string",
          "description": "ID of the entity affected by the action."
        },
        "actionTimestamp": {
          "type": "string",
          "description": "Timestamp of when the action was performed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "adminId",
        "action",
        "affectedEntity",
        "affectedEntityId",
        "actionTimestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user account information.  No denormalized authorization fields are needed as user data is private and accessed via path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores course information. Courses are globally accessible for listing but require admin privileges for creation/modification.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/enrollments/{enrollmentId}",
        "definition": {
          "entityName": "Enrollment",
          "schema": {
            "$ref": "#/backend/entities/Enrollment"
          },
          "description": "Stores enrollment records for each user. No denormalized authorization fields are needed as enrollments are accessed via path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "enrollmentId",
              "description": "The unique identifier for the enrollment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/certificates/{certificateId}",
        "definition": {
          "entityName": "Certificate",
          "schema": {
            "$ref": "#/backend/entities/Certificate"
          },
          "description": "Stores certificates issued to users. No denormalized authorization fields are needed as certificates are accessed via path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "certificateId",
              "description": "The unique identifier for the certificate."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/paymentTransactions/{transactionId}",
        "definition": {
          "entityName": "PaymentTransaction",
          "schema": {
            "$ref": "#/backend/entities/PaymentTransaction"
          },
          "description": "Stores payment transactions made by users. No denormalized authorization fields are needed as transactions are accessed via path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier for the transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/affiliateCommissions/{affiliateCommissionId}",
        "definition": {
          "entityName": "AffiliateCommission",
          "schema": {
            "$ref": "#/backend/entities/AffiliateCommission"
          },
          "description": "Stores affiliate commissions earned by users. No denormalized authorization fields are needed as commissions are accessed via path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "affiliateCommissionId",
              "description": "The unique identifier for the affiliate commission."
            }
          ]
        }
      },
      {
        "path": "/apiLogs/{apiLogId}",
        "definition": {
          "entityName": "ApiLog",
          "schema": {
            "$ref": "#/backend/entities/ApiLog"
          },
          "description": "Stores API request logs. Includes `apiKeyId` for querying logs associated with a specific API key.",
          "params": [
            {
              "name": "apiLogId",
              "description": "The unique identifier for the API log entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/apiKeys/{apiKeyId}",
        "definition": {
          "entityName": "ApiKey",
          "schema": {
            "$ref": "#/backend/entities/ApiKey"
          },
          "description": "Stores API keys for users. No denormalized authorization fields are needed as apiKeys are accessed via path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "apiKeyId",
              "description": "The unique identifier for the API key."
            }
          ]
        }
      },
      {
        "path": "/adminActionLogs/{adminActionLogId}",
        "definition": {
          "entityName": "AdminActionLog",
          "schema": {
            "$ref": "#/backend/entities/AdminActionLog"
          },
          "description": "Stores logs of admin actions. Includes `adminId` for querying logs associated with a specific admin.",
          "params": [
            {
              "name": "adminActionLogId",
              "description": "The unique identifier for the admin action log entry."
            }
          ]
        }
      },
      {
        "path": "/lessons/{lessonId}",
        "definition": {
          "entityName": "Lesson",
          "schema": {
            "$ref": "#/backend/entities/Lesson"
          },
          "description": "Stores lesson information.  Requires admin privileges for creation/modification.",
          "params": [
            {
              "name": "lessonId",
              "description": "The unique identifier for the lesson."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the CourseVerse application, adhering to the principles of Authorization Independence, Structural Segregation, Access Modeling, and Data Clarity. User data is stored under `/users/{userId}`. Courses are stored in a top-level `/courses` collection. Enrollments, Certificates, PaymentTransactions, and AffiliateCommissions are organized as subcollections under the respective user document (`/users/{userId}/enrollments/{enrollmentId}`, `/users/{userId}/certificates/{certificateId}`, `/users/{userId}/paymentTransactions/{transactionId}`, `/users/{userId}/affiliateCommissions/{affiliateCommissionId}`). ApiKeys are also stored as a subcollection under `/users/{userId}/apiKeys/{apiKeyId}` enabling admin-level management of keys. ApiLogs are segregated to `/apiLogs/{apiLogId}` and includes the `apiKeyId` for querying. AdminActionLogs are segregated to `/adminActionLogs/{adminActionLogId}` and include the `adminId` for querying.\\n\\nThis structure achieves Authorization Independence by avoiding hierarchical `get()` calls. For example, while Enrollments are stored under `/users/{userId}`, access control is based on `request.auth.uid === userId`. Similarly, courses are top-level with no dependency on user data for access.\\n\\nThis design supports the QAPs by segregating data based on access needs and employing path-based ownership where appropriate. Listing courses is secure because it does not require any user context. Listing a user's enrollments is restricted to the user themselves via the path-based structure and security rules."
  }
}
    